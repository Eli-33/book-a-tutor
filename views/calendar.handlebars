{{!-- This is the original header --}}
<header class="header">
    <nav class=" navbar-light topnav">
    <h1 class="bat-title">Book-A-Tutor
 <div class="dropdown">
    <button id="logoutButton" class="dropbtn">LOGOUT</button>
       <div class="dropdown-content">
          <a class="btnLogout"  style="padding: 0%;" href="#">Logout</a>
       </div>
 </div>
    </h1>
    <hr>
    </nav>
</header>

<div class="container">
    <div id='calendarDiv'></div>
</div>

<!-- Make a BOOKING Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="booking_modal">Make a Booking</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form class="eventModal">
            <div class="form-group">
            <label for="exampleFormControlSelectSubjects">Select Subject</label>
            <select class="form-control" id="bookingSubject-input">
            <option value="" disabled selected hidden>Please choose...</option>
            </select>
            </div>
            <div class="form-group">
                <label for="exampleFormControlSelect1">Tutor</label>
                <select class="form-control" id="bookingTutor-input">
                </select>
            </div>
            <div class="form-group">
                <label for="bookingStartTime">Start Time</label>
                <input type="datetime-local" id="bookingStartTime-input" name="bookingStartTime">
            </div>
            <div class="form-group">
                <label for="bookingEndTime">End Time</label>
                <input type="datetime-local" id="bookingEndTime-input" name="bookingEndTime">
            </div>
            <div class="form-group">
                <label for="exampleFormControlTextarea1">Link to your online tutoring session</label>
                <textarea class="form-control" id="videoLink-input" rows="1"></textarea>
            </div>
            <div class="form-group">
                <label for="exampleFormControlTextarea1">Notes:</label>
                <textarea class="form-control" id="bookingNotes-input" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="bookingSaveBtn">Save changes</button>
            </div>
            </form>
            </div>
        </div>
    </div>
</div>

{{!-- functionality for the booking modal --}}
<script type="text/javascript">

    $('#bookingModal').on('shown.bs.modal', function (event) {
        event.preventDefault();

        // clear the subject select input of all subjects except the first one (Please select..)
        $('#bookingSubject-input').find('option').not(':first').remove();

        // Send the GET request to get all the subjects
        $.ajax('/api/subjects', {
            type: "GET",
            success: function (response) {

                // fill the subject select with the subjects
                $.each(response, function (i, item) {
                    $('#bookingSubject-input').append($('<option>', {
                        value: item.id,
                        text: item.name
                    }));
                });
            }
        });
    });

    $("#bookingSubject-input").on("change", function (event) {
        event.preventDefault();

        let subjectId = $(this).val();

        // clear the tutor select
        $('#bookingTutor-input').empty();

        // Send the GET request to get the tutors who tutor this subject
        $.ajax('/api/subjecttutors/' + subjectId, {
            type: "GET",
            success: function (response) {

                // fill the tutor select with the subject's tutors
                $.each(response, function (i, item) {
                    $('#bookingTutor-input').append($('<option>', {
                        value: item.User.id,
                        text: `${item.User.firstName} ${item.User.lastName}`
                    }));
                });
            }
        });
    });

    $("#bookingSaveBtn").on("click", function (event) {
        event.preventDefault();

        // get the details and save the booking
        const bookingData = {
            StudentId: sessionStorage.getItem('userId'),
            TutorId: $('#bookingTutor-input').val(),
            SubjectId: $('#bookingSubject-input').val(),
            startTime: $('#bookingStartTime-input').val(),
            endTime: $('#bookingEndTime-input').val(),
            notes: $('#bookingNotes-input').val().trim(),
            videoLink: $('#videoLink-input').val().trim()
        };

        $.post('/api/booking', bookingData)
            .then(() => {
                // go back to the members page
                window.location.replace('/members');
                // If there's an error, log the error
            })
            .fail((err) => {
                console.log(err);
            });

    });

</script>

